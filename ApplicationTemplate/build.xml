<?xml version="1.0"?>
<!-- ====================================================================== 
     Luis Majano
     Mar 16, 2007 5:13:17 PM                                                        

     coldbox.newapplication    
     This task creates a new coldbox application template with your 
     application name already configured.
                
     The task will generate a new application template for you in a 
     directory named GENERATEDAPP. You can change the name of the generated
     folder if you want below.
     ====================================================================== -->
<project name="coldbox.newapplication" default="generate" basedir=".">	
	<!--Properties-->
	<property name="destination" 		value="GENERATEDAPP" />
	<property name="src.dir" 			value="." />
    
	<target name="init" description="Initialize the task">
		<!--Init TimeStamp-->
		<tstamp />
		<!--Ask for user input to create application-->
		<input message="What is the name of your application: (Ex:blog,forum)?"
		       addproperty="app.name"/>
	</target>

	<target name="generate" description="Generate the new skeleton" depends="init">
		<echo>Generating new Application: ${app.name}</echo>
		<echo>Destination Directory: ${basedir}/${destination}</echo>
		<echo>Generation Date: ${TODAY}</echo>
		<echo file="header.txt"><![CDATA[<!--------------------------------------------------------------------
Generated Application: ${app.name}
Generated Date: ${TODAY}
Generated By: ColdBox Ant Task.
---------------------------------------------------------------------->]]>
		</echo>
		<!--Generate-->
		<copy todir="${destination}/${app.name}">
			<fileset dir="${src.dir}">
				<exclude name="${destination}" />
				<exclude name="build.xml" />
			</fileset>
			<filterchain>
				<exclude name="**/*.xml" />
			    <concatfilter prepend="header.txt"/>
			</filterchain>
		</copy>
		<!--Replace AppName in Config -->
		<replace file="${destination}/${app.name}/config/config.xml.cfm" value="${app.name}" summary="yes">
			<replacetoken>Your App Name here</replacetoken>
		</replace>
		<!--Delete Header File-->
		<delete file="header.txt" />
	</target>
</project>
