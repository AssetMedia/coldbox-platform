<!-----------------------------------------------------------------------********************************************************************************Copyright 2005-2008 ColdBox Framework by Luis Majano and Ortus Solutions, Corpwww.coldboxframework.com | www.luismajano.com | www.ortussolutions.com********************************************************************************Author 	 :	Luis MajanoDate     :	September 23, 2005Description :	This is a DATE utilities library.Modification History:-----------------------------------------------------------------------><cfcomponent name="DateUtils"       		 hint="This is a DATE Utilities CFC"       		 extends="coldbox.system.Plugin"       		 output="false"       		 cache="true"       		 cachetimeout="5"><!------------------------------------------- CONSTRUCTOR ------------------------------------------->	<cffunction name="init" access="public" returntype="DateUtils" output="false">		<cfargument name="controller" type="any" required="true">		<cfscript>			super.Init(arguments.controller);						/* Plugin Properties */			setpluginName("Date Utilities Plugin");			setpluginVersion("1.0");			setpluginDescription("This plugin provides various date utilities");			setpluginAuthor("Luis Majano, Sana Ullah");			setpluginAuthorURL("http://www.coldbox.org");						return this;		</cfscript>	</cffunction> <!------------------------------------------- DATE PARSING METHODS ------------------------------------------->	<cffunction name="parseISO8601" access="public" output="false" returntype="string" hint="Parse a UTC or iso8601 date to a normal CF datetime object">		<!--- ******************************************************************************** --->		<cfargument name="datetime" type="string" required="true" hint="The datetime string to convert"/>		<!--- ******************************************************************************** --->		<cfset var returnDate = arguments.datetime>		<cfset var datebits = structnew()>		<cfset var roundedSeconds = "00">		<cfset var wddxPacket = "">				<!--- Date Bits Initialization --->		<cfset datebits.main = returnDate>		<cfset datebits.offset = "">				<!--- Parse if its an ISO Date --->		<cfif REFind("[[:digit:]]T[[:digit:]]", datebits.main)>			<cfscript>			/* Test for Z */			if( datebits.main contains "Z" ){				/* Set Offset to 0 and replace the Z with nothing. */				datebits.offset = "+00:00";				datebits.main = replace(arguments.datetime, "Z", "", "ONE");			}						/* test for containz + */			else if( datebits.main contains "+"){				/* Split offset and remove it from main datetime */				datebits.offset = "+" & ListLast(datebits.main,"+");				datebits.main = replace(datebits.main,datebits.offset,"","ONE");			}							else{				/* Split negative offset and remove it from main datetime */				datebits.offset = "-" & ListLast(datebits.main,"-");				datebits.main = replace(datebits.main,datebits.offset,"","ONE");			}			/* If no seconds, add them */			if( listLen(datebits.main, ":") lt 3){				datebits.main = datebits.main & ":00";			}				/* If it has fractional seconds, round it up. BIG DEAL!! */			roundedSeconds = numberFormat(round(listLast(datebits.main,":")),"00");			datebits.main =	listSetAt(datebits.main, listLen(datebits.main,":"), roundedSeconds,":");			/* Append All */			datebits.main = datebits.main & datebits.offset;						/* Wddx hack to get a datetime object */			wddxPacket = "<wddxPacket version='1.0'><header/><data><dateTime>#datebits.main#</dateTime></data></wddxPacket>";			</cfscript>			<!--- WDDX Hack --->			<cfwddx action="wddx2cfml" input="#wddxPacket#" output="wddxPacket" />			<cfset returnDate = DateConvert("local2utc", wddxPacket) />		</cfif>						<!--- Return the date --->		<cfreturn returnDate>	</cffunction>		<!--- ************************************************************* --->		<cffunction name="parseRFC822" access="public" output="false" returntype="string" hint="Parse RFC822 dates, returns empty string if not a valid date.">		<!--- ******************************************************************************** --->		<cfargument name="datetime" type="string" required="true" hint="The datetime string to convert"/>		<!--- ******************************************************************************** --->		<cfscript>			var formatter = CreateObject("java", "java.text.SimpleDateFormat").init("EEE, dd MMM yyyy HH:mm:ss Z");			var parsePosition = CreateObject("java", "java.text.ParsePosition").init(0);			var results = arguments.datetime;									/* Parse the date */			if( len(arguments.datetime) neq 0 )				results = formatter.parse(arguments.datetime, parsePosition);						/* Null Check */			if( isDefined("results") ){				return results;			}else				return arguments.datetime;		</cfscript>	</cffunction>		<!--- ************************************************************* --->	</cfcomponent>